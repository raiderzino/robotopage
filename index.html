<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Песочница</title>
</head>
<body>
    <textarea id="codeInput" rows="10" cols="50" placeholder="Введите ваш JavaScript код..."></textarea>
    <br>
    <button onclick="runCode()">Выполнить</button>
    <button onclick="showSystemInfo()">Показать информацию о системе</button>
    <button onclick="checkPackages()">Проверить доступные пакеты</button>
    <button onclick="exploreWebView()">Исследовать WebView</button>
    <button onclick="testPostMessage()">Тест postMessage</button>
    <button onclick="testDialogs()">Тест диалогов</button>
    <div id="output"></div>
    <h3>Запуск системных приложений через Intent</h3>
    <ul>
        <li><a href="intent:#Intent;component=com.android.settings/.DevelopmentSettings;end">Открыть настройки разработчика</a></li>
        <li><a href="intent:#Intent;component=com.android.settings/.wifi.WifiSettings;end">Открыть настройки Wi-Fi</a></li>
        <li><a href="intent:#Intent;component=com.android.settings/.Settings;end">Открыть системные настройки</a></li>
        <li><a href="intent:#Intent;component=com.android.settings/.DeviceInfoSettings;end">Открыть информацию об устройстве</a></li>
        <li><a href="intent:#Intent;package=com.dji.go;action=android.intent.action.MAIN;end">Открыть приложение DJI Go</a></li>
        <li><a href="intent:#Intent;package=com.dji.go.v4;action=android.intent.action.MAIN;end">Открыть приложение DJI Go 4</a></li>
        <li><a href="intent:#Intent;package=com.dji.rc;action=android.intent.action.MAIN;end">Открыть приложение DJI RC</a></li>
        <li><a href="intent:#Intent;package=com.dji.settings;action=android.intent.action.MAIN;end">Открыть DJI Settings</a></li>
        <li><a href="intent:#Intent;component=com.android.packageinstaller/.PackageInstallerActivity;end">Открыть установщик пакетов</a></li>
        <li><a href="intent:#Intent;action=android.intent.action.MAIN;category=android.intent.category.HOME;end">Запустить системный лаунчер</a></li>
        <li><a href="intent:#Intent;action=android.intent.action.MAIN;category=android.intent.category.PREFERENCE;end">Открыть все настройки</a></li>
        <li><a href="dji://settings">Открыть DJI Settings (custom URI)</a></li>
        <li><a href="dji://home">Открыть DJI Home (custom URI)</a></li>
        <li><a href="dji://support">Открыть DJI Support (custom URI)</a></li>
        <li><a href="djifly://settings">Открыть DJI Fly Settings (custom URI)</a></li>
        <li><a href="intent:#Intent;package=com.android.vending;action=android.intent.action.VIEW;end">Открыть Google Play</a></li>
        <li><a href="market://details?id=com.android.vending">Открыть Google Play через market</a></li>
        <li><a href="market://details?id=com.teslacoilsw.launcher">Установить Nova Launcher</a></li>
        <li><a href="file:///system/etc">Проверить системные файлы (file://)</a></li>
        <li><a href="file:///data/data/com.dji.go">Проверить данные DJI Go (file://)</a></li>
        <li><a href="content://settings/system">Проверить настройки через Content Provider</a></li>
        <li><a href="content://com.android.settings">Проверить настройки через альтернативный Content Provider</a></li>
    </ul>

    <script>
        function runCode() {
            const code = document.getElementById('codeInput').value;
            const output = document.getElementById('output');
            output.innerHTML = '';

            try {
                const result = new Function(code)();
                if (result !== undefined) {
                    output.innerHTML = String(result);
                }
            } catch (error) {
                output.innerHTML = 'Ошибка: ' + error.message;
            }
        }

        function showSystemInfo() {
            const output = document.getElementById('output');
            output.innerHTML = `
                <strong>Информация о системе:</strong><br>
                Платформа: ${navigator.platform}<br>
                Операционная система: ${navigator.oscpu || 'Недоступно'}<br>
                Браузер: ${navigator.userAgent}<br>
                Язык браузера: ${navigator.language}<br>
                Разрешение экрана: ${window.screen.width}x${window.screen.height}<br>
                Цветовая глубина: ${window.screen.colorDepth} бит<br>
                Часовой пояс: ${Intl.DateTimeFormat().resolvedOptions().timeZone}<br>
                Дата и время: ${new Date().toLocaleString()}
            `;
        }

        function checkPackages() {
            const output = document.getElementById('output');
            output.innerHTML = 'Попытка проверить доступные пакеты...';
            const packages = [
                'com.android.settings',
                'com.dji.go',
                'com.dji.go.v4',
                'com.dji.rc',
                'com.dji.settings',
                'com.android.packageinstaller',
                'com.android.systemui',
                'com.android.vending'
            ];
            output.innerHTML += '<br><strong>Результаты проверки:</strong><br>';
            packages.forEach(pkg => {
                try {
                    const intent = `intent:#Intent;package=${pkg};action=android.intent.action.MAIN;end`;
                    const a = document.createElement('a');
                    a.href = intent;
                    a.click();
                    output.innerHTML += `${pkg}: Intent отправлен (проверьте, открылось ли приложение)<br>`;
                } catch (error) {
                    output.innerHTML += `${pkg}: Ошибка - ${error.message}<br>`;
                }
            });
            output.innerHTML += '<br>Если ничего не открылось, DJI лаунчер блокирует Intent. Попробуйте ссылки ниже или подключение через ПК.';
        }

        function exploreWebView() {
            const output = document.getElementById('output');
            output.innerHTML = 'Исследование WebView...<br>';
            try {
                output.innerHTML += `<strong>User Agent:</strong> ${navigator.userAgent}<br>`;
                output.innerHTML += `<strong>Location:</strong> ${window.location.href}<br>`;
                output.innerHTML += `<strong>Window Objects:</strong> ${Object.keys(window).join(', ')}<br>`;
                output.innerHTML += `<strong>Navigator Objects:</strong> ${Object.keys(navigator).join(', ')}<br>`;
                output.innerHTML += `<strong>IBG JS Manager:</strong> ${typeof window.ibg_js_manager !== 'undefined' ? JSON.stringify(window.ibg_js_manager) : 'Не найден'}<br>`;
                output.innerHTML += `<br>Попробуйте открыть консоль (Ctrl+Shift+J) и выполните: <code>console.log(window)</code> или <code>console.log(navigator)</code> для дополнительной информации.<br>`;
                output.innerHTML += 'Если есть доступ к файлам, попробуйте ссылки file:// или content:// ниже.';
            } catch (error) {
                output.innerHTML += `Ошибка: ${error.message}<br>`;
            }
        }

        function testPostMessage() {
            const output = document.getElementById('output');
            output.innerHTML = 'Тест postMessage...<br>';
            try {
                const messages = [
                    { action: 'openSettings' },
                    { action: 'openDJISettings' },
                    { action: 'launchApp', package: 'com.android.settings' },
                    { action: 'launchApp', package: 'com.dji.go' }
                ];
                messages.forEach(msg => {
                    window.postMessage(JSON.stringify(msg), '*');
                    output.innerHTML += `Отправлено сообщение: ${JSON.stringify(msg)}<br>`;
                });
                output.innerHTML += '<br>Проверьте, вызвало ли это реакцию в DJI Fly. Если нет, WebView может не обрабатывать postMessage.';
            } catch (error) {
                output.innerHTML += `Ошибка: ${error.message}<br>`;
            }
        }

        function testDialogs() {
            const output = document.getElementById('output');
            output.innerHTML = 'Тест диалогов...<br>';
            try {
                alert('Тест alert. Нажмите OK и проверьте реакцию UI.');
                const result = prompt('Тест prompt. Введите что-нибудь:', 'test');
                output.innerHTML += `Prompt результат: ${result || 'Не введено'}<br>`;
                const confirmed = confirm('Тест confirm. Нажмите OK или Cancel.');
                output.innerHTML += `Confirm результат: ${confirmed}<br>`;
                output.innerHTML += '<br>Если диалоги отображаются, это может повлиять на UI DJI Fly. Попробуйте несколько раз.';
            } catch (error) {
                output.innerHTML += `Ошибка: ${error.message}<br>`;
            }
        }
    </script>
</body>
</html>
